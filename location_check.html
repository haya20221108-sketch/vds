<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H1E è¬è§£ã - GPSãƒã‚§ãƒƒã‚¯</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header><p id="user-info">GPSä½ç½®æƒ…å ± ç¢ºèª</p></header>

    <main>
      <h1>ä½ç½®æƒ…å ±æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯</h1>
      <p>
        è¬è§£ããƒãƒƒãƒ—ã§ã¯ç¾åœ¨åœ°ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ç«¯æœ«ã¨ãƒ–ãƒ©ã‚¦ã‚¶ãŒä½ç½®æƒ…å ±ï¼ˆGPSï¼‰ã®åˆ©ç”¨ã‚’è¨±å¯ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚
      </p>

      <div class="container">
        <button id="check-button">ä½ç½®æƒ…å ±ã®åˆ©ç”¨ã‚’è¨±å¯ã™ã‚‹</button>
        <p
          id="message"
          style="margin-top: 15px; font-weight: bold; color: #00796b"
        >
          ğŸ‘† ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§ã€Œè¨±å¯ã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
        </p>

        <div
          id="status-box"
          class="hidden"
          style="
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #4caf50;
            background-color: #e8f5e9;
          "
        >
          <p>
            ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:
            <span id="gps-status" style="color: green; font-weight: bold"
              >å–å¾—æˆåŠŸ</span
            >
          </p>
          <p>ã‚·ã‚¹ãƒ†ãƒ ãŒä½ç½®æƒ…å ±ã‚’èªè­˜ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒ—ã¸é€²ã‚“ã§ãã ã•ã„ã€‚</p>
        </div>

        <button
          id="start-button"
          disabled
          style="margin-top: 20px; background-color: #4caf50"
        >
          è¬è§£ããƒãƒƒãƒ—ã¸é€²ã‚€
        </button>
      </div>
    </main>

    <script>
      const NEXT_PAGE_URL = "map.html";
      const checkButton = document.getElementById("check-button");
      const startButton = document.getElementById("start-button");
      const messageDisplay = document.getElementById("message");
      const statusBox = document.getElementById("status-box");

      checkButton.addEventListener("click", startLocationCheck);
      startButton.addEventListener("click", () => {
        window.location.href = NEXT_PAGE_URL;
      });

      function startLocationCheck() {
        if (!("geolocation" in navigator)) {
          updateStatus(
            "ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚",
            "red",
            false
          );
          return;
        }

        checkButton.disabled = true;
        updateStatus("GPSã®åˆ©ç”¨è¨±å¯ã‚’ç¢ºèªä¸­...", "orange", false);

        // ä½ç½®æƒ…å ±å–å¾—ã‚’è©¦ã¿ã‚‹
        navigator.geolocation.getCurrentPosition(
          (position) => {
            // æˆåŠŸæ™‚ (ä½ç½®æƒ…å ±ãŒå–ã‚Œã¦ã„ã‚‹)
            handleSuccess();
          },
          (error) => {
            // å¤±æ•—æ™‚ (è¨±å¯æ‹’å¦ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãªã©)
            handleError(error);
          },
          {
            timeout: 5000, // 5ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
            maximumAge: 0,
          }
        );
      }

      function handleSuccess() {
        updateStatus("ä½ç½®æƒ…å ±ã®åˆ©ç”¨ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸï¼", "green", true);
        statusBox.classList.remove("hidden");
        checkButton.style.display = "none"; // ãƒã‚§ãƒƒã‚¯ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«
        startButton.disabled = false;
      }

      function handleError(error) {
        let errorMessage = "ä½ç½®æƒ…å ±å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
        switch (error.code) {
          case error.PERMISSION_DENIED:
            errorMessage =
              "ã€æ‹’å¦ã•ã‚Œã¾ã—ãŸã€‘ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ä½ç½®æƒ…å ±ã®åˆ©ç”¨ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚";
            break;
          case error.POSITION_UNAVAILABLE:
            errorMessage = "ã€æ©Ÿèƒ½ã‚¨ãƒ©ãƒ¼ã€‘ä½ç½®æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã€‚";
            break;
          case error.TIMEOUT:
            errorMessage =
              "ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€‘é›»æ³¢ã®è‰¯ã„å ´æ‰€ã§å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚";
            break;
        }
        updateStatus(errorMessage, "red", false);
        checkButton.disabled = false;
        startButton.disabled = true;
        statusBox.classList.add("hidden");
      }

      function updateStatus(message, color, isSuccess) {
        messageDisplay.textContent = message;
        messageDisplay.style.color = color;
        if (isSuccess) {
          document.getElementById("gps-status").textContent = "å–å¾—æˆåŠŸ";
        } else {
          document.getElementById("gps-status").textContent = "ã‚¨ãƒ©ãƒ¼";
        }
      }
    </script>
  </body>
</html>
